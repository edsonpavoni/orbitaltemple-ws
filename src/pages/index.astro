---
import Base from "../layouts/BaseLayout.astro";
import HomeRitualButton from "../components/HomeRitualButton";
import RitualButtonPlaceholder from "../components/RitualButtonPlaceholder.astro";
import HomeHero from "../components/HomeHero";
import HomeCTA from "../components/HomeCTA";
import ManifestoContent from "../components/ManifestoContent";
import FooterCredits from "../components/FooterCredits";
import "../styles/ritual-button.css";
// import YetAnotherTemple from "../components/YetAnotherTemple.astro";
---
<Base title="Orbital Temple">

  <!-- First Fold: Hero Section with Satellite Background -->
  <section style="position: relative; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: space-between; padding: 1.5rem 1.5rem 36px 1.5rem;">
    <!-- Satellite Background Video -->
    <div style="position: absolute; inset: 0; z-index: 0;">
      <!-- Mobile Video -->
      <video
        autoplay
        loop
        muted
        playsinline
        poster="/videos/mobile_placeholder.webp"
        style="width: 100%; height: 100%; object-fit: cover; opacity: 0.6; display: block;"
        class="mobile-video">
        <source src="/videos/mobile.webm" type="video/webm" />
        <source src="/videos/mobile_h264.mp4" type="video/mp4" />
      </video>

      <!-- Desktop Video -->
      <video
        autoplay
        loop
        muted
        playsinline
        poster="/videos/desk_placeholder.webp"
        style="width: 100%; height: 100%; object-fit: cover; opacity: 0.6; display: none;"
        class="desktop-video">
        <source src="/videos/desk_h264.webm" type="video/webm" />
        <source src="/videos/desk_h264.mp4" type="video/mp4" />
      </video>
    </div>

    <!-- Top spacer for vertical centering -->
    <div style="flex: 1; min-height: 2rem;"></div>

    <!-- Hero Content (centered) -->
    <div style="text-align: center; max-width: 600px; position: relative; z-index: 1;">
      <HomeHero client:only="react" />
    </div>

    <!-- Ritual Button (centered in remaining space) -->
    <div style="flex: 1; display: flex; align-items: center; justify-content: center; position: relative; z-index: 1; min-height: 2rem;">
      <a href="/send-a-name" id="ritual-button-link" style="display: inline-block; text-decoration: none; color: inherit;" aria-label="Enter the ritual - Send a name to the Orbital Temple">
        <div id="ritual-button-container" style="position: relative; display: flex; justify-content: center; margin: 0;">
          <!-- Immediate placeholder (no JS needed) -->
          <div id="ritual-placeholder-wrapper">
            <RitualButtonPlaceholder size={123} label="ritual" />
          </div>

          <!-- Enhanced version (loads after page is interactive) -->
          <div id="ritual-button-enhanced" style="position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 0.4s ease-in; pointer-events: none;">
            <HomeRitualButton client:only="react" />
          </div>
        </div>
      </a>
    </div>

    <script>
      // Progressive enhancement: swap placeholder with interactive version when loaded
      function initRitualButton() {
        const placeholder = document.getElementById('ritual-placeholder-wrapper');
        const enhanced = document.getElementById('ritual-button-enhanced');

        if (!placeholder || !enhanced) return;

        // Wait for the React component to be ready
        const checkInterval = setInterval(() => {
          const component = enhanced.querySelector('.ritual-wrap-v6');
          if (component) {
            // Component is ready, swap
            enhanced.style.opacity = '1';
            enhanced.style.pointerEvents = 'auto';
            placeholder.style.opacity = '0';
            placeholder.style.pointerEvents = 'none';

            clearInterval(checkInterval);
          }
        }, 100);

        // Cleanup after 5 seconds
        setTimeout(() => clearInterval(checkInterval), 5000);
      }

      // Run on page load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initRitualButton);
      } else {
        initRitualButton();
      }

      // Run on Astro page transitions
      document.addEventListener('astro:page-load', initRitualButton);
    </script>

    <!-- Bottom link with 36px margin (from padding) -->
    <div style="position: relative; z-index: 1; width: 100%;">
      <HomeCTA client:only="react" />
    </div>
  </section>

  <!-- Second Fold: Dome Image -->
  <section id="dome" style="position: relative; width: 100%; background-color: var(--color-ot-dark);">
    <picture>
      <source media="(min-width: 768px)" srcset="/UI/dome_large.webp" />
      <img src="/UI/dome.webp" alt="Dome" style="width: 100%; height: auto; display: block;" />
    </picture>
  </section>

  <!-- Third Section: Manifesto -->
  <section style="position: relative; background-color: var(--color-ot-dark);">
    <ManifestoContent client:only="react" />
  </section>

  <!-- Footer: Credits -->
  <footer style="background-color: var(--color-ot-dark); padding: 4rem 1.5rem 2rem 1.5rem;">
    <FooterCredits client:only="react" />
  </footer>

  <!-- Responsive Video Styles -->
  <style is:global>
    /* Mobile: show mobile video, hide desktop video */
    .mobile-video {
      display: block !important;
    }
    .desktop-video {
      display: none !important;
    }

    /* Desktop: hide mobile video, show desktop video */
    @media (min-width: 768px) {
      .mobile-video {
        display: none !important;
      }
      .desktop-video {
        display: block !important;
      }
    }
  </style>

</Base>
