---
import BaseLayout from "../layouts/BaseLayout.astro";
---

<BaseLayout title="Be Notified - Orbital Temple">

  <!-- Full Screen Form Section -->
  <section style="position: relative; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 1.5rem;">

    <!-- Satellite Background Video -->
    <div style="position: absolute; inset: 0; z-index: 0;">
      <!-- Mobile Video -->
      <video
        autoplay
        loop
        muted
        playsinline
        poster="/videos/mobile_placeholder.webp"
        style="width: 100%; height: 100%; object-fit: cover; opacity: 0.6; display: block;"
        class="mobile-video">
        <source src="/videos/mobile.webm" type="video/webm" />
        <source src="/videos/mobile_h264.mp4" type="video/mp4" />
      </video>

      <!-- Desktop Video -->
      <video
        autoplay
        loop
        muted
        playsinline
        poster="/videos/desk_placeholder.webp"
        style="width: 100%; height: 100%; object-fit: cover; opacity: 0.6; display: none;"
        class="desktop-video">
        <source src="/videos/desk_h264.webm" type="video/webm" />
        <source src="/videos/desk_h264.mp4" type="video/mp4" />
      </video>
    </div>

    <!-- Content -->
    <div style="position: relative; z-index: 1; text-align: center; max-width: 500px; width: 100%;">

      <!-- Title -->
      <h1 style="font-size: 28px; line-height: 1.3; font-weight: 700; color: #ffffff; margin-bottom: 1rem;">
        Be Notified When It Rises
      </h1>

      <!-- Description -->
      <p style="font-size: 16px; line-height: 1.6; color: #ffffff; opacity: 0.8; margin-bottom: 2rem;">
        On November 28, 2025, the Orbital Temple will ascend.<br>
        Leave your e-mail, and we will tell you when it reaches space.
      </p>

      <!-- Form -->
      <form id="notify-form" style="display: flex; flex-direction: column; gap: 1rem; max-width: 400px; margin: 0 auto;">
        <input
          type="email"
          id="email"
          name="email"
          placeholder="your@email.com"
          required
          style="padding: 1rem; background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); border-radius: 4px; color: #ffffff; font-size: 16px; font-family: inherit; outline: none; transition: all 0.2s;"
        />
        <button
          type="submit"
          style="padding: 1rem 2rem; background: var(--color-ot-gold200); color: var(--color-ot-dark); font-weight: 700; font-size: 16px; border: none; border-radius: 4px; cursor: pointer; transition: all 0.2s; font-family: inherit;"
        >
          Send
        </button>
      </form>

      <!-- Success Message (hidden by default) -->
      <div id="success-message" style="display: none; margin-top: 2rem; padding: 1rem; background: rgba(250, 212, 58, 0.2); border: 1px solid var(--color-ot-gold200); border-radius: 4px;">
        <p style="color: #ffffff; margin: 0; font-size: 16px;">
          We will reach you when it ascends.
        </p>
      </div>

      <!-- Back Link -->
      <a href="/" style="display: inline-block; margin-top: 2rem; color: #ffffff; opacity: 0.6; text-decoration: none; font-size: 14px; transition: opacity 0.2s;">
        ‚Üê Back to countdown
      </a>

    </div>

  </section>

  <!-- Media Query for Desktop Video -->
  <style is:global>
    /* Hide header on notify page */
    body header {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
    }

    @media (min-width: 768px) {
      .mobile-video {
        display: none !important;
      }
      .desktop-video {
        display: block !important;
      }
    }

    /* Input focus styles */
    input:focus {
      background: rgba(255, 255, 255, 0.15) !important;
      border-color: var(--color-ot-gold200) !important;
    }

    /* Button hover */
    button:hover {
      background: var(--color-ot-gold100) !important;
      transform: translateY(-2px);
    }

    /* Link hover */
    a:hover {
      opacity: 1 !important;
    }
  </style>

  <!-- Form Handling Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const form = document.getElementById('notify-form') as HTMLFormElement;
      const successMessage = document.getElementById('success-message');
      const submitButton = form?.querySelector('button[type="submit"]') as HTMLButtonElement;

      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();

          const emailInput = document.getElementById('email') as HTMLInputElement;
          const email = emailInput.value;

          // Disable button during submission
          if (submitButton) {
            submitButton.disabled = true;
            submitButton.textContent = 'Sending...';
          }

          try {
            // Call Firebase function to subscribe to launch notifications
            const response = await fetch('https://us-central1-orbital-temple.cloudfunctions.net/subscribeLaunchNotification', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ email })
            });

            const result = await response.json();

            if (response.ok && result.success) {
              // Show success message
              if (successMessage) {
                form.style.display = 'none';
                successMessage.style.display = 'block';
              }
            } else {
              // Handle error
              alert('Something went wrong. Please try again.');
              if (submitButton) {
                submitButton.disabled = false;
                submitButton.textContent = 'Send';
              }
            }
          } catch (error) {
            console.error('Error submitting email:', error);
            alert('Something went wrong. Please try again.');
            if (submitButton) {
              submitButton.disabled = false;
              submitButton.textContent = 'Send';
            }
          }
        });
      }
    });
  </script>

</BaseLayout>
